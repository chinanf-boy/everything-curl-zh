
# 超时

网络操作本质上是相当不可靠的,或可能是脆弱的操作,因为它们工作依赖于一组服务和网络的建立.这些服务的可用性可以有和没有,并且不时它们的性能也可能变化很大.

TCP的设计甚至允许网络在较长的时间内完全断开连接,这样在传输过程中就不需要参与者注意它.

这样做的结果是,有时互联网传输需要很长时间.此外在默认情况下,大多数curl操作是没有超时!

## 允许花费的最大时间

告诉cURL命令行`-m / --max-time`,可在超时错误代码(28)之前,退出命令行的最大时间,以秒为单位. 当超过设定的时间,cURL将退出, 无论发生在那一刻,包括如果它正在传输数据.这确实是允许的最大时间.

给定的最大时间可以用十进制精度指定;`0.5`意味着500毫秒`2.37`等于2370毫秒.

例子:

```
curl --max-time 5.5 https://example.com/
```

(您的 locale 可以使用另一个符号来表示`点`数值分数.)

## 永远不要花费更多的时间来连接

`--connect-timeout`限制cURL花费尝试连接到主机的时间. 在连接被认为完成之前, 完成的所有必要步骤都必须在给定的时间内完成.如果在给定的时间内无法连接,将导致超时退出代码(28)退出.

给定的最大连接时间可以用十进制精度指定;`0.5`意味着500毫秒`2.37`等于2370毫秒:

```
curl --connect-timeout 2.37 https://example.com/
```

## 传输速度比这个方式慢, 就退出

若cURL操作有一个固定的的最大时间可能很麻烦,特别是如果您执行脚本传输,并且文件大小和传输时间变化很大.一个固定的超时值需要设置为不必要的高,以覆盖最坏的情况.

作为固定超时的替代,如果curl低于某个速度,并在特定时间段内保持在该阈值以下,则可以告诉curl放弃传输.

例如,如果传输速度在15秒内每秒低于1000字节,请停止:

```
curl --speed-time 15 --speed-limit 1000 https://example.com/
```

## 保持连接活性

curlL使TCP在默认情况下, 保持活性.keep-alive是TCP一个特性,它使TCP堆栈在没有通信量时,向另一端发送探测,以确保它仍然存在,并"活着".通过使用保持生存,curlL更有可能发现TCP连接已经死亡.

使用`--keepalive-time`要指定在整个多少秒,您希望探头发送到对等点的频率.默认值为60秒.

有时这种探测会干扰了你正在做的事情,然后你可以很容易地禁用它`--no-keepalive`.
