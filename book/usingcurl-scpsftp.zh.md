
## SCP与SFTP

curl支持SCP和SFTP协议, 前提是有第三方库[libssh2](https://www.libssh2.org/)正确构建.

SCP和SFTP都是建立在SSH之上的协议,SSH是一种安全且加密的数据协议,类似于TLS,但在一些重要方面有所不同.例如,SSH不使用任何类型的证书,而是使用公钥和私钥.SSH和TLS在正确使用时,都提供了强大的加密和安全传输.

SCP协议通常被认为是两者的败笔,因为它非常不可移植的,通常只在Unix系统之间工作.

### URLs

SFTP和SCP URL类似于其他URL,并且使用这些协议下载文件与其他协议相同:

```
curl sftp://example.com/file.zip -u user
```

还有:

```
curl scp://example.com/file.zip -u user
```

SFTP(但不是SCP)支持当URL以尾随斜线结束时, 获得文件列表的返回:

```
curl sftp://example.com/ -u user
```

请注意,这两个协议都与"users"一起工作,并且不能用匿名或其他标准通用名称获取文件. 大多数系统将要求用户进行认证,如下所述.

当从SFTP或SCP URL请求文件时,给定的文件路径被认为是远程服务器上的绝对路径,除非您特别要求相对于用户的主目录的路径. 如你这样做`/~/`是确定路径的开始. 这与FTP URL的工作恰恰相反,是用户之间混淆的常见原因.

为用户`daniel`从他的家庭目录传输`todo.txt`,它将类似于此:

```
curl sftp://example.com/~/todo.txt -u daniel
```

### Auth

TBD

### 已知主机

安全的网络客户端需要确保远程主机正是它认为正在与之通信的主机. 使用基于TLS的协议,它由客户端验证服务器的证书来完成.

使用没有服务器证书的SSH协议,就变成了每个服务器提供它唯一的密钥.与TLS不同,SSH没有证书颁发机构或任何东西,因此客户端只需要确保主机的密钥与它已经知道(通过其他方式)的样子匹配.

密钥的匹配通常使用密钥的散列来完成,并且客户端常常存储已知服务器的散列的文件在`known_hosts`文件夹, 且这文件夹放置在专用的SSH目录中. 在Linux系统通常`~/.ssh`.

当curl连接到SFTP和SCP主机时,它将确保主机的密钥散列已经存在于已知的主机文件中,或者它将拒绝继续操作,因为它不能相信服务器是正确的. 一旦正确的散列存在`known_hosts`, cURL就可以进行传输.

强制cURL跳过检查,并通过`known_hosts`文件,可以使用`-k / --insecure`命令行选项.你必须非常小心地使用这个选项,因为它使得中间人攻击的可能性不被检测到.
