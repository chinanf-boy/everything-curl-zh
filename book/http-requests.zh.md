
# 修改HTTP请求

如前所述,每个HTTP传输都是从发送一个HTTP请求的cURL开始的.该请求由请求行和多个请求头组成,本章详细说明了如何修改所有这些请求头.

## 请求方法

请求的第一行包括*方法*有时也被称为"动词".当执行一个简单的GET请求时,这个命令行会这样做:

```
curl http://example.com/file
```

……最初的请求线看起来像这样:

```
GET /file HTTP/1.1
```

您可以通过使用CURL来将方法更改为其他内容.`-X`或`--request`命令行选项后面跟着实际的方法名称.例如,您可以发送`DELETE`而不是`GET`这样地:

```
curl http://example.com/file -X DELETE
```

此命令行选项仅更改传出请求中的文本,不会更改任何行为.这是特别重要的,如果你,例如,要求cURL送头.`-X`当指定要发送所有头的头时,get响应将得到.*从未*发送一个响应体,即使标题暗示另一个会出现.所以,增加`-X HEAD`否则,命令行会导致cURL挂起,等待一个不会出现的响应体.

当要求curl执行HTTP传输时,它会根据选项选择正确的方法,所以您应该很少需要显式地要求使用`-X`. 还应该注意到,当cURL遵循重定向,如要求与`-L`,请求方法设置为`-X`甚至会在后续重定向上发送.

## 请求目标

在上面的示例中,您可以看到URL的路径部分是如何变成的.`/file`在请求行中.这就是所谓的"请求目标".这是请求将与之交互的资源.通常,这个请求目标从URL中提取,然后在请求中使用,作为用户,您不需要考虑它.

在某些罕见情况下,用户可能希望进行创造性,并以URL不允许的方式更改这个请求目标.例如,HTTP选项方法有专门定义的魔法目标请求目标.*服务器*而不是一个特定的路径,它使用`*`为此.是的,一个星号.无法为此指定URL,因此,如果希望将请求目标中的单个星号传递给服务器,比如OPTIONS,则必须像这样做:

```
curl -X OPTIONS --request-target "*" http://example.com/
```

## 锚或碎片

URL可以包含锚,也称为片段,它在URL结尾用磅符号和字符串编写.比如说`http://example.com/foo.html#here-it-is`. 这个片段部分,从磅/散列符号到URL的末尾,仅用于本地使用,不会通过网络发送.cURL将简单地剥离该数据并丢弃它.

## 自定义页眉

在HTTP请求中,在初始请求行之后,通常会遵循多个请求标头.那是一套`name: value`以空白行结束的一对,将标题与下列请求正文分开(有时为空).

默认情况下,cURL将在请求中传递几个头,例如`Host:`,`Accept:`,`User-Agent:`以及其他一些可能取决于用户要求CURL做什么.

由cURL本身设置的所有头可以被重写,如果用户替换,则由用户替换.你就告诉科尔`-H`或`--header`要使用的新报头,如果报头字段匹配其中的一个报头,则它将替换内部报头,或者它将将指定报头添加到请求中发送的报头列表中.

改变`Host:`标题,这样做:

```
curl -H "Host: test.example" http://example.com/
```

添加一个`Elevator: floor-9`标题,这样做:

```
curl -H "Elevator: floor-9" http://example.com/
```

如果只想删除内部生成的标头,只需将其设置为没有值的curl,在冒号的右侧没有任何值.

关掉`User-Agent:`标题,这样做:

```
curl -H "User-Agent:" http://example.com/
```

最后,如果确实想在冒号的右侧添加没有内容的标题(这很罕见),那么它的神奇标记是用*分号*. 这样地:

```
curl -H "Empty;" http://example.com
```

## 引用者

当用户单击网页上的链接并且浏览器将用户带到下一个URL时,它将在新请求中向新URL发送一个"referer"标头,告诉它来自哪里.这是引用头.是的,引用者拼写错了,但这就是它应该有的样子!

用CURL设置引用头`-e`或`--referer`,像这样:

```
curl --referer http://comes-from.example.com https://www.example.com/
```

## 用户代理

用户代理是每个客户端可以在请求中设置的报头,通知服务器它是哪个用户代理.有时服务器将查看此标头并确定如何根据其内容进行操作.

默认标题值为"cURL/[版本]就像在`User-Agent: curl/7.54.1`对于cURL版本7.54.1.

您可以使用选项设置任何您喜欢的值.`-A`或`--user-agent`加上要使用的字符串,或者因为它只是一个标题,`-H "User-Agent: foobar/2000"`.

作为比较,最近在Linux机器上的Firefox测试版本发送了这个用户代理头:

`User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0`

## 时间条件

HTTP允许"条件请求".它们是包含分隔符的请求,也就是说,如果相关条件评估为真,则请求服务器仅传递响应主体.

一个有用的条件是时间.对于EXANMPLE,请请求服务器只在特定时间后修改了资源后提供响应:

```
curl --time-cond "1 Jul 2011" https://www.example.org/file.html
```

cURL也能扭转这种情况.只得到文件,如果它是*老年人*比给定日期的日期用短跑预定义:

```
curl --time-cond "-1 Jul 2011" https://www.example.org/file.html
```

日期解析器非常宽松,可以接受编写日期的大多数格式,当然也可以指定一个时间完成日期:

```
curl --time-cond "Sun, 12 Sep 2004 15:05:58 -0700" https://www.example.org/file.html
```

CURL还可以将本地文件的时间戳作为快捷方式.如果服务器上没有更改文件,则不需要再次下载该文件,对吗?如果字符串与时间或日期不匹配,则cURL检查是否有一个名为该文件的文件,如果是,则从其修改时间获得时间.

```
curl --time-cond file https://www.example.org/file.html -o file
```
