
# 名字解析

大多数传输LabCURL可以涉及一个需要首先翻译成Internet地址的名称.这就是"名字解析".在URL中直接使用数字IP地址通常可以避免名称解析阶段,但是在许多情况下,用IP地址手动替换名称并不容易.

拼命尝试[重新使用现有连接](libcurl-connectionreuse.md)而不是创造和连接一个新的.检查要使用的现有连接的函数完全基于名称,并在尝试任何名称解析之前执行.这也是重用的原因之一.使用重用连接的传输将无法再次解析主机名.

如果不能重用连接,libcurl将主机名称解析为解析到的地址集.通常这意味着同时请求IPv4和IPv6地址,并且可能有一组返回到LIPURL.然后,尝试一组地址,直到一个工作,或者它返回失败.

应用程序可以通过设置强制LIPURL只使用IPv4或IPv6解析地址.`CURLOPT_IPRESOLVE`达到优选值.例如,要求只使用IPv6地址:

```
curl_easy_setopt(easy, CURLOPT_IPRESOLVE, CURL_IPRESOLVE_V6);
```

## 名称解析器后端

libcurl可以用至少三种不同的方式进行名称解析,并且根据使用的后端方式,它获得稍微不同的特性集,有时还会修改行为.

1.  默认的后端在新的帮助线程中调用"普通"libc解析器函数,这样如果需要,它仍然可以执行细粒度的超时,并且不会涉及阻塞调用.

2.  在较旧的系统上,libcurl使用标准的同步名称解析功能.不幸的是,它们在运行过程中会在一个多手柄块内进行所有的传输,因此很难及时地完成.

3.  还支持使用c-ares第三方库进行解析,该库支持不使用线程的异步名称解析.这更好地扩展到大量的并行传输,但是并不总是100%兼容本机名称解析器功能.

## 高速缓存

当一个名称被解析后,结果将被放入libcurl的内存缓存中,以便只要该名称被保存在DNS缓存中,相同名称的后续解析将几乎立即进行.默认情况下,每个条目被保存在缓存中60秒,但该值可以随`CURLOPT_DNS_CACHE_TIMEOUT`.

DNS缓存保存在容易处理的时间内.`curl_easy_perform`当使用多接口时,使用或在多手柄内.它也可以在多个简单句柄之间共享.[共享接口](libcurl-sharing.md).

## 主机的自定义地址

有时,为真实主机名提供"假"地址很方便,这样libcurl将连接到不同的地址,而不是实际的名称解析所建议的地址.

借助于[克罗普特溶液](https://curl.haxx.se/libcurl/c/CURLOPT_RESOLVE.html)选项,应用程序可以预先为给定的主机名和端口号填充自定义地址的libcurl DNS缓存.

为了使libcurl连接到127.0.0.1,当请求端口443上的ExpLo.com时,应用程序可以:

```
struct curl_slist *dns;
dns = curl_slist_append(NULL, "example.com:443:127.0.0.1");
curl_easy_setopt(curl, CURLOPT_RESOLVE, dns);
```

因为这将"假"地址放入DNS缓存中,即使在重定向之后也可以工作.

## 名称服务器选项

对于使用C-ARES构建的libcurl,有一些选项可以提供细粒度的DNS服务器使用和如何控制.这仅限于C-ARES的构建,因为在使用标准系统调用名称解析的时候,这些是不可用的.

-   用`CURLOPT_DNS_SERVERS`应用程序可以选择使用一组专用DNS服务器.

-   用`CURLOPT_DNS_INTERFACE`它可以告诉libcurl哪个网络接口来代替DNS而不是DNS.

-   用`CURLOPT_DNS_LOCAL_IP4`和`CURLOPT_DNS_LOCAL_IP6`应用程序可以指定将DNS解析的特定网络地址解析为.

## 全局DNS缓存不好

是一个*贬低*选项调用`CURLOPT_DNS_USE_GLOBAL_CACHE`启用时告诉CURL使用全局DNS缓存.此缓存没有锁,并将数据存储在全局上下文中,然后其他所有设置为使用全局缓存的简单句柄都可以共享这些数据.

此选项只应用于遗留应用程序和您.*应该*将此转换为使用共享接口来共享DNS缓存"适当"的方式.此选项将在将来的版本中删除.
