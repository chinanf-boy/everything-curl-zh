# 退出状态

在项目中投入了大量的精力,使得当出现问题时,curl返回一个可用的退出代码,而当操作按计划进行,它总是返回0(零).

如果编写调用curl的shell脚本或批处理文件,则始终可以检查返回代码,以检测调用的命令中的问题.,在撰写的本文下面, 您将找到返回代码列表.随着时间的推移,我们倾向于缓慢地添加新的代码,所以如果您得到的代码没有在这里列出, 请参考更多更新的curl文档以获得帮助.

一个非常基本的UNIX shell脚本可以是这样的:

```
#!/bin/sh
curl http://example.com
res=$?
if test "$res" != "0"; then
   echo "the curl command failed with: $res"
fi
```

## 可用退出码

1.  不支持的协议. 此cURL的构建不支持该协议.通常这是因为URL拼写错误,如使用了前面有空格或拼写"http"如"htpt"或类似的协议部分.另一个常见的错误是,您使用了一个libcurl安装,它构建时禁用了一个或多个协议,现在您要求的就是libcurl构建中禁用的那些协议之一.

2.  初始化失败.这主要是内部错误或libcurl安装或系统libcurl运行中的问题.

3.  URL畸形.语法不正确.当错误键入URL而导致错误时,或在少数情况下,您使用的URL被另一个curl不支持的工具所接受, 这只是因为并不是所有人都遵守的通用URL标准.

4.  执行的请求所需的功能或选项未启用或在构建时被显式禁用.为了使cURL能够做到这一点,你可能需要另一个libcurl构建!

5.  无法解析代理. 无法解析给定代理主机的地址.要么给定的代理名称是错误的,要么DNS服务器行为不当,并且当应该知道该名称时它不知道,或者甚至可能您运行curl的系统配置不当,从而无法找到/使用正确的DNS服务器.

6.  无法解析主机. 给定的远程主机地址未被解析.无法解析给定服务器的地址.要么给定主机名是错误的,要么DNS服务器行为不当,并且当应该知道该名称时它不知道,或者甚至可能您运行curl的系统配置不当,从而无法找到/使用正确的DNS服务器.

7.  未能连接到主机.curl设法获得机器的IP地址,它试图建立一个TCP连接到主机,但失败了.这可能是因为您指定了错误的端口号、输入了错误的主机名、错误的协议,或者可能是因为在它们之间有一个防火墙或其他网络设备阻止了通信量的通过.

8.  未知的FTP服务器响应. 服务器发送的数据curl无法解析.这或者是由于curl中的bug、服务器中的bug,或者是因为服务器使用了curl不支持的FTP协议扩展.唯一的真正解决方法是调整curl选项,尝试使用其他FTP命令,这些命令可能不会返回这个未知的服务器响应.

9.  拒绝FTP访问. 服务器拒绝登录或拒绝访问您想要到达的特定资源或目录.大多数情况下,您可以试试更改到服务器上不存在的目录.当然,目录是URL中指定的内容.

10. FTP接受失败.当使用活动FTP会话时等待服务器连接回来时,来自控制的连接或类似方式会发送错误代码.

11. FTP怪异PASS回复. curl无法解析答复curl发送的PASS请求. PASS在curl命令中是发送密码到服务器,甚至到FTP服务器的匿名连接,而匿名实际上发送一个密码——一个固定的匿名字符串. 而这个命令中获取curl不理解的响应, 会强烈地指示它根本不是FTP服务器,或者服务器严重损坏.

12. 在等待服务器连接的活动FTP会话(端口被使用)期间,超时过期.服务器花了太长时间才回来.这通常是阻止服务器达到cURL的迹象.像防火墙或其他网络管理.

13. 对FTP PASV命令的未知响应, curl无法解析答复curl发送的PASV请求. 这是一个奇怪的服务器.PASV用于在被动模式下建立第二数据传输连接,请参见[FTP使用两个连接](ftp-twoconnections.zh.md)关于这个更多的章节.您可以通过使用端口`--ftp-port`选项来解决这个问题.

14. 未知的FTP 227格式. curl无法解析服务器发送的227-行.这肯定是一个坏了的服务器. 227是FTP服务器的响应, 当发送回curl,告诉curl应如何以被动方式连接到它.您可以通过使用端口`--ftp-port`选项来解决这个问题.

15. FTP无法获得主机. 无法使用227行中的主机IP地址.这很可能是内部错误!

16. HTTP/2错误.在HTTP2成帧层中检测到问题.这有点通用,因为是几个问题中的一个,请参阅详细错误信息.

17. FTP无法设置二进制. 无法将转换方法转换为二进制.这个服务器坏了.cURL需要在启动之前将传输设置为正确模式,否则传输无法工作.

18. 部分文件. 只传输了文件的一部分.当认为传输完成时,curl将验证它实际接收的数据量,与它之前被告知将要获得的数据量相同.如果这两个数字不匹配,这就是错误代码.这可能意味着cURL比预告的少了字节,或者更多.cURL本身不知道哪个数字是错的或哪个是正确的. 如果有的话.

19. FTP无法下载/访问给定的文件. RETR(或类似)命令失败.在尝试下载文件时,错误来自服务器.

20. **不使用**

21. 引用错误. 来自服务器的引用命令错误. curl允许几种不同的方式向IMAP、POP3、SMTP或FTP服务器发送自定义命令,并且具有这些命令是否工作的通用检查功能. 当任何单独发出的命令失败时,这将返回退出状态.通常建议在FTP通信中观察header,以便更好地理解失败的原因和方法.

22. 没有检索到HTTP页面. 未找到请求的URL,或返回HTTP错误代码为400或以上的另一错误. 此返回代码仅在`-f, --fail`使用.

23. 写入错误. curl无法将数据写入本地文件系统或类似文件. curl通过网络一块块接收数据块,并且一次存储一个数据块(或将其写入stdout). 如果写操作发生错误,这是退出状态.

24. **不使用**

25. 上传失败. 服务器拒绝接受或存储cURL试图发送给它的文件.这通常是由于服务器上的错误访问权限造成的,但也可能由于磁盘空间或其他资源限制而发生. 这种错误可能发生在许多协议中.

26. 读取错误. 各种读取问题. 退出状态23的对面. 当curl向服务器发送数据时,它会从本地文件或stdin或类似的文件中逐块读取数据, 如果读取失败,则curl返回退出状态.

27. 内存不足. 内存分配请求失败. curl需要分配更多的内存,而系统不愿意给的,而curl必须退出. 尝试使用较小的文件,或确保cURL获得更多的内存使用.

28. 操作超时. 根据条件达到指定的超时周期.cURL提供几种[超时](usingcurl-timeouts.zh.md),这个退出代码告诉了我们这其中一个超时限制. 延长超时时间或尝试其他允许加快cURL完成的操作.通常情况下,这是由于网络和远程服务器情况,而不是本地的锅.

29. **不使用**

30. FTP端口失败. 端口命令失败.并非所有FTP服务器都支持PORT命令; 可尝试使用PASV进行传输! PORT命令用于请求服务器创建数据连接*回接*cURL,也见[FTP使用两个连接](ftp-twoconnections.zh.md)部分.

31. FTP无法使用REST. REST命令失败.此命令用于恢复FTP传输.curl需要发出REST命令来执行range或resume传输. 服务器是坏的,尝试相同的但没有range/resume的操作!

32. **不使用**

33. HTTP range 错误. range请求无效.恢复的HTTP请求不被确认或支持,因此此退出代码发出信号,表示对于此服务器上的此资源,不能有 range 或恢复传输.

34. HTTP POST错误. 内部POST请求生成错误.如果你得到这个错误,请向cURL项目报告具体情况!

35. TLS/SSL连接错误. SSL握手失败.SSL握手可能由于许多不同的原因而失败,因此错误消息可以提供一些额外的线索.也许各方不能同意SSL/TLS版本,一个合意的密码套件或类似的.

36. 糟糕的下载恢复. 无法继续较早中止的下载.当要求恢复一个不可能完成的传输时,可以返回这个错误.对FILE,FTP或SFTP.

37. 在使用`FILE://` 协议时,无法读取给定文件. 打开文件失败.文件可能不存在,或者是权限问题吗?

38. LDAP无法绑定. LDAP"绑定"操作失败,这是LDAP操作中的必要步骤,因此这意味着无法执行LDAP查询.这可能是因为用户名或密码错误,或者其他原因造成的.

39. LDAP搜索失败. 给定的搜索项导致LDAP搜索返回错误.

40. **不使用**

41. **不使用**

42. 回调中止. 一个应用程序告诉libcurl中止操作.此错误代码通常不会对用户可见,和不是对cURL工具的用户可见.

43. 错误函数参数.一个函数被调用了一个坏的参数——这个返回代码帮助应用程序作者理解为什么libcurl不能执行某些动作,并且永远不应该被cURL工具返回.如果发生这种情况,请向curl项目提交bug报告!

44. **不使用**

45. 接口错误. 无法使用指定的外出网络接口.curl通常会自行决定呼出网络和IP地址,但当明确要求特定网络而curl不能使用时,可能发生此错误.

46. **不使用**

47. 重定向太多.当遵循HTTP重定向时,libcurl被应用程序所设置的最大数目击中了.重定向的最大数目不受libcurl限制,但默认情况下被cURL工具设置为50. 这个限制是为了停止无尽的重定向循环. 改变限制`--max-redirs`.

48. 指定给libcurl的未知选项.如果使用与底层libcurl版本不同步的cURL版本,可能会发生这种情况.也许您的新curl尝试使用旧libcurl中的一个选项,该选项是您之后的libcurl版本才引入的,但是您的curl工具代码知道这个选项比较新.为了减少这种风险并确保它不会发生:使用相同版本号的cURL和libcurl.

49. 畸形的telnet选项. 您提供给curl的telnet选项没有使用正确的语法.

50. **不使用**

51. 服务器的SSL/TLS证书或SSH指纹验证失败. curl然后不能确定服务器是谁声称了谁.见[使用cURL的TLS](usingcurl-tls.zh.md)更多TLS细节部分和[用cURL的SCP and SFTP](usingcurl-scpsftp.md)更多SSH的具体细节.

52. 服务器没有回复任何内容,在这种情况下被认为是一个错误.当HTTP(S)服务器响应HTTP请求时,它总是返回*something*. 只要它是活的和发声的.所有有效的HTTP响应都有状态行和响应标头.没有得到任何回复表示服务器有故障,或者可能阻止curl到达正确的服务器,或者您试图连接到错误的端口号等.

53. 没有找到SSL加密引擎.

54. 无法将SSL密码引擎设置为默认值.

55. 发送网络数据失败.通过网络发送数据是大多数curl操作的关键部分,当curl从最低层-网络层得到发送失败的错误时,将返回此退出状态.为了明确为什么会发生这种情况,通常需要进行一些深度挖掘.从启用日志模式开始,进行跟踪,如果可能的话,使用Wireshark或类似的工具检查网络流量.

56. 接收网络数据失败.在网络上接收数据是大多数cURL操作的关键部分,当curl从接收数据失败的最低层-网络层获得错误时,将返回该退出状态.为了明确为什么会发生这种情况,通常需要进行一些深度挖掘.从启用日志模式开始,进行跟踪,如果可能的话,使用Wireshark或类似的工具检查网络流量.

57. **不使用**

58. 本地证书的问题.客户端证书有问题,因此无法使用.权限?错误的词组?

59. 无法使用指定的SSL密码.

60. 对等证书不能用于,已知CA证书进行身份验证.

61. 无法识别的传输编码.

62. 无效的LDAP URL.

63. 超过最大文件大小.

64. 请求的FTP SSL级别失败.

65. 发送要求倒带的数据失败.

66. 初始化SSL引擎失败.

67. 用户名、密码或类似的内容不被接受,cURL无法登录.

68. 在TFTP服务器上找不到文件.

69. TFTP服务器的权限问题.

70. TFTP服务器上的磁盘空间.

71. 非法TFTP操作.

72. 未知的TFTP传输ID.

73. 文件已经存在(TFTP).

74. 没有这样的用户(TFTP).

75. 字符转换失败.

76. 需要字符转换函数.

77. 阅读SSL CA证书的问题

78. URL中引用的资源不存在.

79. SSH会话期间发生了一个未指定的错误.

80. 关闭SSL连接失败.

81. **不使用**

82. 无法加载CRL文件,丢失或错误格式

83. 证书颁发者检查失败

84. FTP PRET命令失败

85. RTSP:CSeq数字的失配

86. RTSP:会话标识符的不匹配

87. 无法解析FTP文件列表

88. FTP块回调报告错误

89. 没有可用的连接,会话将被排队

90. SSL公钥与指定的公钥不匹配

91. 无效的SSL证书状态

92. HTTP/2 成帧层中的流 错误

## 错误信息

当cURL以非零代码退出时,它也会输出错误消息(除非`--silent`使用).该错误消息可以向退出状态号本身添加一些附加信息或环境,因此相同的错误号可以获得不同的错误消息.

## "不使用"

上面的退出代码列表包含许多标记为"不使用"的值.这些是退出状态代码在现代版本的curl中是不使用,但过去已经使用或打算使用.它们可以很好地应用在未来的cURL版本中.

另外,这个列表中使用的最高错误状态是92,但是不能保证将来的curl版本不会决定在该数字之后，添加更多的退出代码.
