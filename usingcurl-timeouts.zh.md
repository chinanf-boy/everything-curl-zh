
# 超时

网络操作本质上是相当不可靠的,或者可能是脆弱的操作,因为它们依赖于一组服务和网络来建立并工作.这些服务的可用性可以来和去,并且它们的性能也可能不时地变化很大.

TCP的设计甚至允许网络在较长的时间内完全断开连接,而不必在传输过程中受到参与者的注意.

这样做的结果是,有时互联网传输需要很长时间.此外,大多数卷曲操作在默认情况下没有超时!

## 允许花费的最大时间

告诉卷发`-m / --max-time`在命令行在超时错误代码(28)之前退出命令行的最大时间,以秒为单位.当设定的时间已经过去,卷曲将退出,无论发生在那一刻,包括如果它正在传输数据.这确实是允许的最大时间.

给定的最大时间可以用十进制精度指定;`0.5`意味着500毫秒`2.37`等于2370毫秒.

例子:

```
curl --max-time 5.5 https://example.com/
```

(您的区域可以使用另一个符号来表示数值分数.)

## 永远不要花费更多的时间来连接

`--connect-timeout`限制时间卷曲将花费尝试连接到主机.在连接被认为完成之前完成的所有必要步骤都必须在给定的时间框架内完成.如果在给定的时间内无法连接,将导致超时退出代码(28)退出.

给定的最大连接时间可以用十进制精度指定;`0.5`意味着500毫秒`2.37`等于2370毫秒:

```
curl --connect-timeout 2.37 https://example.com/
```

## 传输速度比这个方式慢

有一个固定的卷曲操作的最大时间可能很麻烦,特别是如果您执行脚本传输,并且文件大小和传输时间变化很大.一个固定的超时值需要设置为不必要的高,以覆盖最坏的情况.

作为固定超时的替代,如果curl低于某个速度并在特定时间段内保持在该阈值以下,则可以告诉curl放弃传输.

例如,如果传输速度在15秒内每秒低于1000字节,请停止:

```
curl --speed-time 15 --speed-limit 1000 https://example.com/
```

## 保持联系

CURL使TCP在默认情况下保持生存.TCP.-alive是一个特性,它使TCP堆栈在没有通信量时向另一端发送探测,以确保它仍然存在,并"活着".通过使用保持生存,CURL更有可能发现TCP连接已经死亡.

使用`--keepalive-time`要指定在整个秒内您希望探头发送到对等点的频率.默认值为60秒.

有时这种探测干扰了你正在做的事情,然后你可以很容易地禁用它.`--no-keepalive`.
